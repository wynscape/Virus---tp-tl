<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Biology@RI - Virus Interactive</title>
    <style>
        :root { --dim: rgba(0,0,0,0.25); --bg: #ffffff; --txt: #000000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: none; }
        body { 
            background: var(--bg); color: var(--txt); font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        
        header { text-align: center; padding: 20px 10px; width: 100%; }
        .t1 { font-size: 1.8rem; font-weight: 800; margin: 0; }
        .t2 { font-size: 1.1rem; font-weight: 400; margin: 5px 0; }
        .t3 { font-size: 0.65rem; color: var(--dim); text-transform: uppercase; letter-spacing: 1px; }

        .stage { 
            display: flex; width: 100%; max-width: 500px; flex: 1; 
            justify-content: space-around; align-items: flex-start; padding-top: 20px;
        }
        
        .v-col { display: flex; flex-direction: column; align-items: center; width: 32%; }
        .v-label { font-size: 0.6rem; font-weight: bold; margin-bottom: 10px; height: 30px; text-align: center; }

        .virus-svg { width: 90px; height: 90px; cursor: pointer; }
        .envelope { stroke: #ccc; stroke-width: 4; fill: none; transition: opacity 0.5s; }
        .capsid { stroke: #999; stroke-width: 2; fill: none; transition: opacity 0.5s; }
        .genome { fill: none; stroke-width: 2.5; stroke-linecap: round; }

        .tray { 
            width: 100%; background: #f9f9f9; padding: 20px 10px; 
            display: flex; justify-content: center; gap: 15px; border-top: 1px solid #eee;
        }
        .tool { 
            padding: 10px 12px; border-radius: 6px; font-size: 0.7rem; font-weight: bold;
            background: #fff; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            z-index: 100; pointer-events: auto;
        }

        #feedback { 
            padding: 15px; font-size: 0.75rem; text-align: center; min-height: 60px; 
            color: #444; width: 100%; max-width: 400px;
        }

        footer { font-size: 0.65rem; color: var(--dim); padding: 15px; }

        /* Animation classes */
        .hidden { opacity: 0; pointer-events: none; }
        .assembling { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.2; } 50% { opacity: 0.8; } 100% { opacity: 0.2; } }
    </style>
</head>
<body>

<header>
    <div class="t1">Virus</div>
    <div class="t2">Types of genome and replication</div>
    <div class="t3">Biology@RI</div>
</header>

<div id="feedback">Drag a molecule onto a virus to explore its replication cycle.</div>

<div class="stage">
    <div class="v-col">
        <div class="v-label">Virus A<br>(+ssRNA)</div>
        <svg class="virus-svg" id="vA" viewBox="0 0 100 100">
            <circle class="envelope" cx="50" cy="50" r="45" />
            <circle class="capsid" cx="50" cy="50" r="30" />
            <path class="genome" d="M40,50 Q45,40 50,50 T60,50" stroke="#2ecc71" />
        </svg>
    </div>
    <div class="v-col">
        <div class="v-label">Virus B<br>(-ssRNA)</div>
        <svg class="virus-svg" id="vB" viewBox="0 0 100 100">
            <circle class="envelope" cx="50" cy="50" r="45" />
            <circle class="capsid" cx="50" cy="50" r="30" />
            <path class="genome" d="M35,45 Q40,35 45,45 T55,45 T65,45" stroke="#e74c3c" />
        </svg>
    </div>
    <div class="v-col">
        <div class="v-label">Virus C<br>(dsDNA)</div>
        <svg class="virus-svg" id="vC" viewBox="0 0 100 100">
            <circle class="envelope" cx="50" cy="50" r="45" />
            <circle class="capsid" cx="50" cy="50" r="30" />
            <path class="genome" d="M35,48 Q45,38 55,48 T75,48" stroke="#3498db" />
            <path class="genome" d="M35,52 Q45,42 55,52 T75,52" stroke="#2980b9" />
        </svg>
    </div>
</div>

<div class="tray">
    <div class="tool" id="t_rdrp" data-type="rdrp">Viral RdRp</div>
    <div class="tool" id="t_ribo" data-type="ribo">Host Ribosome</div>
    <div class="tool" id="t_dtrp" data-type="dtrp">Host RNA Pol</div>
</div>

<footer class="t3">All rights reserved</footer>

<script>
/**
 * OBFUSCATED LOGIC CORE
 * Prevents easy modification/copying of scientific rules.
 */
const _0x51=[
    '616374697665','706f696e746572646f776e','706f696e7465726d6f7665','706f696e7465727570',
    '646174612d74797065','7641','7642','7643','7269626f','72647270','64747270'
];
const _0x42 = k => decodeURIComponent(k.replace(/.{2}/g, '%$1'));

let activeNode = null;
let startX, startY;

const tools = document.querySelectorAll('.tool');
const feedback = document.getElementById('feedback');

tools.forEach(t => {
    t.addEventListener('pointerdown', startDrag);
});

function startDrag(e) {
    activeNode = e.currentTarget;
    const rect = activeNode.getBoundingClientRect();
    startX = e.clientX - rect.left;
    startY = e.clientY - rect.top;
    activeNode.style.position = 'fixed';
    activeNode.style.zIndex = '1000';
    moveAt(e.clientX, e.clientY);
    document.addEventListener('pointermove', onMove);
    document.addEventListener('pointerup', onEnd);
}

function onMove(e) { if (activeNode) moveAt(e.clientX, e.clientY); }

function moveAt(x, y) {
    activeNode.style.left = (x - startX) + 'px';
    activeNode.style.top = (y - startY) + 'px';
}

function onEnd(e) {
    if (!activeNode) return;
    activeNode.style.display = 'none';
    const dropTarget = document.elementFromPoint(e.clientX, e.clientY);
    activeNode.style.display = 'block';
    
    const virus = dropTarget ? dropTarget.closest('.virus-svg') : null;
    if (virus) {
        processLogic(virus.id, activeNode.getAttribute(_0x42(_0x5[4])));
    }

    activeNode.style.position = 'static';
    activeNode.style.zIndex = 'auto';
    activeNode = null;
    document.removeEventListener('pointermove', onMove);
    document.removeEventListener('pointerup', onEnd);
}

function processLogic(vId, toolType) {
    const v = document.getElementById(vId);
    // Remove layers
    v.querySelector('.envelope').classList.add('hidden');
    v.querySelector('.capsid').classList.add('hidden');

    // Science Logic mapping
    if (vId === _0x42(_0x5[5])) { // Virus A (+RNA)
        if (toolType === _0x42(_0x5[8])) {
            success(v, "<b>+ssRNA:</b> Ribosomes bind directly to translate proteins. Viral RdRp is then used to replicate the genome via a negative intermediate.");
        } else {
            fail("Host enzymes cannot read RNA. +ssRNA needs a Ribosome first.");
        }
    } else if (vId === _0x42(_0x5[6])) { // Virus B (-RNA)
        if (toolType === _0x42(_0x5[9])) {
            success(v, "<b>-ssRNA:</b> Must use Viral RdRp to create a (+) template. Host lacks RNA-dependent-RNA-Pol. Ribosomes then translate the (+) strand.");
        } else {
            fail("Ribosomes cannot translate (-) antisense RNA directly. Use Viral RdRp first.");
        }
    } else if (vId === _0x42(_0x5[7])) { // Virus C (DNA)
        if (toolType === _0x42(_0x5[10])) {
            success(v, "<b>dsDNA:</b> Uses Host RNA Polymerase (DNA-dependent) to transcribe mRNA, which is then translated by host ribosomes.");
        } else {
            fail("This is DNA. It requires a DNA-dependent RNA Polymerase from the host.");
        }
    }
}

function success(v, txt) {
    feedback.innerHTML = txt;
    feedback.style.color = "#27ae60";
    setTimeout(() => {
        v.querySelector('.envelope').classList.remove('hidden');
        v.querySelector('.capsid').classList.remove('hidden');
        v.querySelector('.envelope').classList.add('assembling');
        v.querySelector('.capsid').classList.add('assembling');
    }, 1000);
}

function fail(txt) {
    feedback.innerHTML = txt;
    feedback.style.color = "#c0392b";
}
</script>
</body>
</html>
